### (p. 172, GC) 일반적으로 알림을 구현할 때 Redis를 사용하는 이유?

-   Redis의 pub/sub 시스템은 매우 단순한 구조를 가지고 있다.
-   NoSQL 데이터베이스이기 때문에 구조가 단순하고 데이터를 빠르게 저장하고 액세스할 수 있다.
-   Redis의 pub/sub 시스템은 메시지를 브로드캐스트하는 기능만 제공한다.
-   메시지를 "던지는" 시스템이기 때문에, 메시지를 따로 보관하지도 않는다.

<br/>

**메시지 큐를 사용하는게 더 안전하고 좋지 않을까?**

-   pub/sub 기능을 구현하는 데 메시지 큐를 사용할 수도 있음
-   그러나 메시지 큐는 Redis보다 성능이 떨어질 수 있음
-   Redis의 pub/sub 기능은 메시지를 보장하는 것이 아님
-   **만약 중요한 메시지를 처리하는 경우에는 메시지 큐를 사용하는 것이 더 안전**
-   이런 사항들을 고려하여 적절한 기술을 선택해야 함

<br/>

### (p. 174, GC) 알림 서버를 다중화했고 각 3자 서비스 각각에 요청을 보내는 것이므로 메시지 큐 도입하지 않아도 장애 전파가 안 일어나지 않을까?

-   책에서 메시지 큐의 도입으로 시스템 컴포넌트 간 의존성을 제거하기 위해 사용했다고 설명하고 있음
-   추가적으로 알림의 종류별로 별도 메시지 큐를 사용하였기 때문에, 다른 알림 종류의 장애가 다른 알림 종류로 전파되지 않는다고 설명하고 있음
-   메시지 큐 도입이 아니더라도, 종류별로 독립적인 별도 알림 시스템을 구성한다면, 장애 전파가 일어나지 않을 것임

<br/>

### (p.176, SM) 분산 시스템 특성상 왜 알림의 중복 전송이 일어나게 되는가?

> https://bravenewgeek.com/you-cannot-have-exactly-once-delivery/

분산 시스템에서 "정확히 한 번"의 전송을 보장하는 것은 불가능하다는 주장이 이 글에서 나오고 있다. 이는 네트워크 지연, 시스템 장애 등과 같은 예측할 수 없는 요소들 때문이다.

실제로 가능한 전달 방식은 "최소 한 번(at-least-once)" 또는 "최대 한 번(at-most-once)"이다. "최소 한 번" 전달에서는 메시지가 한 번 이상 전달되지만, "최대 한 번" 전달에서는 메시지가 전달되지 않을 수도 있다.

"정확히 한 번"의 전달을 흉내내는 방법에는 메시지 처리를 멱등(idempotent)하게 만들거나, 메시지의 상태를 추적하는 방법이 있다. 멱등 처리란 동일한 작업을 여러 번 수행해도 결과가 변하지 않도록 하는 것이며, 메시지 상태 추적은 전달된 메시지를 추적하여 이미 처리된 메시지를 무시하는 방법이다.

"정확히 한 번"의 전달이 원칙적으로 불가능한 이유는 두 가지다.

-   첫째, 송신측과 수신측 사이의 전송을 신뢰할 수 없다는 것과
-   둘째, 두 시스템 사이의 동기화 없이는 이를 보장할 수 없다는 점이다.

결국, 분산 시스템에서 "정확히 한 번"의 전달을 보장하려는 노력은 과도한 비용과 복잡성을 초래하므로, 대신 "최소 한 번" 또는 "최대 한 번"의 전달 방식을 사용하고 이에 대한 대응책을 마련하는 것이 더 합리적인 접근 방식이라는 것이 이 글의 결론이다.
